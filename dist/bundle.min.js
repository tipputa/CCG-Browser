var bio=function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}function o(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function a(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(i,!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):h(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}for(var r,l=Object.prototype.hasOwnProperty,c=function(t,e){return null!=t&&l.call(t,e)},u=Object.keys,d=Math.pow(2,53)-1,g=(r="length",function(t){return null==t?void 0:t[r]}),f=function(t,e,i){if(void 0===e)return t;switch(null==i?3:i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,s){return console.log(e),t.call(e,i,n,s)};case 4:return function(i,n,s,o){return t.call(e,i,n,s,o)}}return function(){return t.apply(e,arguments)}},p=function(t){if(!function(t){var i=e(t);return"function"===i||"object"===i&&!!t}(t))return[];if(u)return u(t);var i=[];for(var n in t)c(t,n)&&i.push(n);return i},v=function(t,e,i){var n,s;if(e=f(e,i),function(t){var e=g(t);return"number"==typeof e&&e>=0&&e<=d}(t))for(n=0,s=t.length;n<s;n++)e(t[n],n,t);else{var o=p(t);for(n=0,s=o.length;n<s;n++)e(t[o[n]],o[n],t)}return t},m=function(t,e){return function(i,n,s){var o=e?[[],[]]:{};return n=f(n,s),v(i,(function(e,s){var h=n(e,s,i);t(o,e,h)})),o}},y=m((function(t,e,i){c(t,i)?t[i].push(e):t[i]=[e]})),b=m((function(t,e,i){c(t,i)?t[i]++:t[i]=1})),w=m((function(t,e,i){t[i]=e})),x=function(t){var e=[];return function(t){for(var i=0;i<t;i++)e.push({})}(t[0].seq.length),v(t,(function(t){var i,n;i=t.seq,n=i.split(""),v(n,(function(t,i){t in e[i]?e[i][t]++:e[i][t]=1}))})),e},C=function(t){var e=[];return v(t,(function(t){t.hasOwnProperty("-")?e.push(!1):e.push(!0)})),e},S=function(t){var e=0;return v(t,(function(t){t.hasOwnProperty("-")||e++})),e},P=function(t,e){var i=[];return v(t,(function(t){t.hasOwnProperty("-")?i.push(t["-"]/e):i.push(0)})),i},q=function(t,e){var i=[];return v(t,(function(t){var n={},s=0;v(t,(function(t,i){var o=-1*t/e*Math.log2(t/e);n[i]=o,s+=o})),n.Entropy=Math.log2(22)-s,v(n,(function(i,s){"Entropy"!==s&&(n[s]=n.Entropy*t[s]/e)})),i.push(n)})),i},_=function(t){var e=[],i={},n=0;return v(t,(function(t,i){t>.1&&"Entropy"!==i&&(e.push({name:i,value:t}),n+=t)})),e.sort((function(t,e){return e.value-t.value})),i.sum=n,i.res=e,i},k=function(t,e){var i=[];return t.length!==e.length?(console.log("not match: "+t.length+" "+e.length),i):(v(t,(function(t,n){e[n]&&i.push(t)})),i)},R=function(t){var e=[];return v(t,(function(t){e.push(">"+t.name),e.push(t.seq)})),e.join("\n")},I=function(t,e){var i=[];return v(t,(function(t){var n=k(t.seq.split(""),e);i.push(">"+t.name),i.push(n.join(""))})),i.join("\n")},M=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];i(this,t),this.elements=e,this.mouse=null,this.isSvgChild=n}return s(t,[{key:"on",value:function(t,e,i){var n=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return v(this.elements,(function(o){o.addEventListener(t,(function(){var t=o.getBoundingClientRect();n.mouse=[event.clientX-t.left-o.clientLeft,event.clientY-t.top-o.clientTop],e.call(i),n.mouse=null}),s)})),this}},{key:"create",value:function(e){var i=this,n=[];return v(this.elements,(function(t){if("svg"==e||i.isSvgChild){var s=document.createElementNS("http://www.w3.org/2000/svg",e);t.appendChild(s),n.push(s),i.isSvgChild=!0}else{var o=document.createElement(e);t.appendChild(o),n.push(o)}})),new t(n,this.isSvgChild)}},{key:"remove",value:function(){v(this.elements,(function(t){t.parentNode.removeChild(t)}))}},{key:"style",value:function(t,e){return v(this.elements,(function(i){i.style.setProperty(t,e)})),this}},{key:"attr",value:function(t,e){return v(this.elements,(function(i){i.setAttribute(t,e)})),this}},{key:"setClass",value:function(t){return this.attr("class",t)}},{key:"setID",value:function(t){return this.attr("id",t)}},{key:"html",value:function(t){if(1!=arguments.length){var e=[];return v(this.elements,(function(t){e.push(t.textContent)})),1===e.length?e[0]:e}if(!t)return v(this.elements,(function(e){e.textContent=t})),this;v(this.elements,(function(e){e.textContent=t}))}},{key:"innerHTML",value:function(t){if(1!=arguments.length){var e=[];return v(this.elements,(function(t){e.push(t.innerHTML)})),1===e.length?e[0]:e}if(!t)return v(this.elements,(function(e){e.innerHTML=t})),this;v(this.elements,(function(e){e.innerHTML=t}))}}]),t}(),z=function(t){return new M([document.getElementById(t)])},D=function(t){return new M([document.querySelector(t)])},H={A:"#ccff00",R:"#0000ff",N:"#cc00ff",D:"#ff0000",C:"#ffff00",Q:"#ff00cc",E:"#ff0066",G:"#ff9900",H:"#0066ff",I:"#66ff00",L:"#33ff00",K:"#6600ff",M:"#00ff00",F:"#00ff66",P:"#ffcc00",S:"#ff3300",T:"#ff6600",W:"#00ccff",Y:"#00ffcc",V:"#99ff00",B:"#fff",X:"#fff",Z:"#fff","-":"rgb(200,200,200)","\\":"rgb(200,200,200)"},L=function(t,e,i){var n,s,o,h=i*e,a=t/60,r=h*(1-Math.abs(a%2-1));0<=a&&a<1?(n=h,s=r,o=0):1<=a&&a<2?(n=r,s=h,o=0):2<=a&&a<3?(n=0,s=h,o=r):3<=a&&a<4?(n=0,s=r,o=h):4<=a&&a<5?(n=r,s=0,o=h):5<=a&&a<6&&(n=h,s=0,o=r);var l=i-h,c=[n+l,s+l,o+l];return n=c[0],s=c[1],o=c[2],[n=Math.floor(255*n),s=Math.floor(255*s),o=Math.floor(255*o)]},O=[],J=1;J>=.5;J-=.1)for(var A=1;A>=.5;A-=.25)for(var G=0;G<360;G++)O.push("rgb("+L(G,A,J).join(",")+")");var W=function(t){return O[12*t]},T=function(t,e){return O[t*e]},E={};E.A=W(0),E.B=W(1),E.C=W(2),E.D=W(3),E.E=W(4),E.F=W(5),E.G=W(6),E.H=W(7),E.I=W(8),E.J=W(9),E.K=W(10),E.L=W(11),E.M=W(12),E.N=W(13),E.O=W(14),E.P=W(15),E.Q=W(16),E.R=W(17),E.S=W(18),E.T=W(19),E.U=W(20),E.V=W(21),E.W=W(22),E.X=W(23),E.Y=W(24),E.Z=W(25),E["-"]="rgb(200,200,200)";var B=function(t,e){var i=document.createElement("a");return i.download=t,i.href=e,i},j=function(t,e){var i=new Blob([t],{type:"type/plain"}),n=window.URL.createObjectURL(i);B(e,n).click()},X=function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,s=new Blob([JSON.stringify(t,i,n)],{type:"application/json"}),o=window.URL.createObjectURL(s);B(e,o).click()},Y=function(){function t(){i(this,t),this.x=100,this.y=100,this.layerX=0,this.layerY=0,this.width=100,this.height=200,this.modal_class="def-modal-class"}return s(t,[{key:"makeModal",value:function(){var t=this,e=D("body").on("dragover",(function(){event.preventDefault(),console.log(event)})).create("div").style("position","absolute").style("left",this.x+"px").style("top",this.y+"px").style("height",this.height+"px").style("width",this.width+"px").style("z-index",10).style("background-color","rgb(255,0,0)");e.create("div").attr("draggable","true").style("position","relative").style("height","30px").style("width",this.width+"px").setClass(this.modal_class).style("background-color","rgb(200,200,200)").on("dragend",(function(){e.style("left",event.pageX-t.layerX+"px").style("top",event.pageY-t.layerY+"px")})).on("dragstart",(function(){t.layerX=event.layerX,t.layerY=event.layerY,console.log(event),event.dataTransfer.setDragImage(t.box,0,0)}));e.create("div").style("position","relative").style("background-color","rgb(20,0,0)").style("width",this.width).style("height","200px")}}]),t}(),F={width:0,height:0,left:0,top:0,right:0,bottom:0},N={fontSize:13},K={id:"def",setSize:!1,height:600,width:600,seqHeight:25,isGrouping:!0,colorScheme:H,header:a({},F,{},N,{height:100,top:10,enable:!0}),seqLogo:{enable:!0},nonGapRate:{enable:!0,left:10,top:10,bottom:0,baseColor:"rgb(120,120,120)",highColor:"rgb(30, 30, 250)",th:1},label:a({},F,{},N,{fontSize:13,left:10,top:0,width:300}),sequence:a({},F,{},N,{fontSize:12,left:10,right:10,top:0,width:480,topMargin:0,bottomMargin:0}),scaleBar:a({},N,{fontSize:13,height:40,enable:!0})},U=Math.PI/2,V=function(t,e){t.lineWidth=e},Z=function(t,e){t.textAlign=e},Q=function(t,e){t.fillStyle=e},$=function(t,e,i,n,s,o){t.beginPath(),t.moveTo(e,n),t.lineTo(i,s),t.strokeStyle=o,t.stroke()},tt=function(t,e,i,n,s,o,h){var a=h<0?"rgba(200,200,200)":O[h];t.beginPath(),t.arc(e,i,n,s-U,o-U),t.strokeStyle=a,t.stroke()},et=function(t,e,i,n,s){t.font=s,t.fillText(e,i,n)},it=function(t,e,i){t.clearRect(0,0,e,i)},nt=function(){function t(e){i(this,t),this.start=0,this.end=e,this.size=e,this.preStart=-1,this.preEnd=-1}return s(t,[{key:"update",value:function(t){this.start=0,this.end=t,this.size=t,this.preStart=-1,this.preEnd=-1}}]),t}(),st=function(){function t(e,n){i(this,t),this.height=500,this.width=500,this.mainCanvas=null,this.isDragging=!1,this.id=e,this.container=null,this.inputJson=null,this.options=a({},K,{},n),this.numSeq=0,this.group=null,this.canvasHeight=0,this.headerContainer=null,this.bodyContainer=null,this.labelContainer=null,this.labelDiv=null,this.canvasContainer=null,this.ctx=null,this.alignmentPosition=null,this.baseWidth=0,this.seqLength=0,this.orderedAlignments=null,this.highlightedIndicies=null,this.isConservedRegionMode=!1,this.conservedRegionBooleanArr=null,this.conservedRegionLength=0,this.headerCanvas=null,this.headerCtx=null,this.seqStat=null,this.gapRate=null,this.shannonEntropyArr=null}return s(t,[{key:"setContainer",value:function(t){this.container=z(t),this.container.html(""),this.options.id=t,this.options.setSize?(this.height=this.options.height,this.width=this.options.width):(this.width=this.container.elements[0].clientWidth,this.height=this.container.elements[0].clientHeight)}},{key:"setJson",value:function(t){var e=this;this.inputJson=t,this.numSeq=t.sequences.length,this.canvasHeight=this.numSeq*this.options.seqHeight+50,this.seqLength=this.inputJson.sequences[0].seq.length,this.alignmentPosition=new nt(this.seqLength),this.seqStat=x(this.inputJson.sequences),this.conservedRegionBooleanArr=C(this.seqStat),this.conservedRegionLength=S(this.seqStat),this.gapRate=P(this.seqStat,this.numSeq),this.shannonEntropyArr=q(this.seqStat,this.numSeq),this.options.isGrouping&&function(){e.group=function(t){var e={},i=0;return v(t,(function(t,n,s){t.group in e?(e[t.group].count++,e[t.group].names.push(t.name)):e[t.group]={count:1,col:T(i++,45),names:[t.name]}})),e}(e.inputJson.sequences);var t=0,i=function(i){v(e.inputJson.sequences,(function(e){e.group===i&&(e.order=t++)}))};for(var n in e.group)i(n)}(),this.orderedAlignments=new Array(this.inputJson.sequences.length),v(this.inputJson.sequences,(function(t){e.orderedAlignments[t.order]=t}))}},{key:"render",value:function(){this._DOMcreate(),this.ctx=this.mainCanvas.elements[0].getContext("2d"),this._initHeader(),this._drawSequenceLabel(),this.drawSequences()}},{key:"zoomInShowSequence",value:function(){this.alignmentPosition.end-this.alignmentPosition.start<20||(this.alignmentPosition.preStart=this.alignmentPosition.start,this.alignmentPosition.preEnd=this.alignmentPosition.end,this.alignmentPosition.start=0,this.alignmentPosition.end=30,this.drawSequences())}},{key:"change2conservedRegion",value:function(){this.isConservedRegionMode=!0,this.alignmentPosition.update(this.conservedRegionLength),this.drawSequences()}},{key:"change2allRegion",value:function(){this.isConservedRegionMode=!1,this.alignmentPosition.update(this.seqLength),this.drawSequences()}},{key:"saveRawJson",value:function(){X(this.inputJson,"all_rawJson_".concat(this.id,".json"))}},{key:"saveAllSequence",value:function(){j(R(this.inputJson.sequences),"all_alignments_".concat(this.id,".fas"))}},{key:"saveConservedRegion",value:function(){j(I(this.inputJson.sequences,this.conservedRegionBooleanArr),"conservedRegion_alignments_".concat(this.id,".fas"))}},{key:"saveVisualizedRegion",value:function(){var t=this;if(this.isConservedRegionMode){var e=[];v(this.inputJson.sequences,(function(i){var n=k(i.seq.split(""),t.conservedRegionBooleanArr).slice(parseInt(t.alignmentPosition.start+.5),parseInt(t.alignmentPosition.end+.5)).join("");e.push({name:i.name,seq:n})})),j(R(e),"visualizedRegion_conserved_".concat(this.id,".fas"))}else{var i=[];v(this.inputJson.sequences,(function(e){var n=e.seq.substr(parseInt(t.alignmentPosition.start+.5),parseInt(t.alignmentPosition.end+.5)-parseInt(t.alignmentPosition.start+.5));i.push({name:e.name,seq:n})})),j(R(i),"visualizedRegion_".concat(this.id,".fas"))}}},{key:"_DOMcreate",value:function(){var t=this;this.options.sequence.width=this.width-this.options.label.width-this.options.label.left-this.options.sequence.left-this.options.sequence.right,this.headerContainer=this.container.create("div").setID("".concat(this.options.id,"_header")),this.bodyContainer=this.container.create("div").setID("".concat(this.options.id,"_body")).style("position","relative").setClass("d-flex flex-row"),this.canvasContainer=this.bodyContainer.create("div").setID("".concat(this.options.id,"_canvasContainer")).style("position","relative").style("height","".concat(this.canvasHeight,"px")),this.labelContainer=this.bodyContainer.create("div").setID("".concat(this.options.id,"_label")).style("margin-left","".concat(this.options.label.left,"px")).style("margin-top",this.options.label.top+this.options.scaleBar.height+"px"),this.mainCanvas=this.canvasContainer.create("canvas").setID("".concat(this.options.id,"_canvas")).style("position","absolute").style("left",this.options.label.width+this.options.label.left+"px").style("top",this.options.sequence.top+"px").attr("height",this.canvasHeight).attr("width",this.width-this.options.label.width-this.options.label.left),this.mainCanvas.on("mousemove",(function(){event.preventDefault(),t.isDragging&&t._move(event.movementX/window.devicePixelRatio)})).on("mousewheel",(function(){event.preventDefault(),event.deltaY>0?t._zoomOut():event.deltaY<0&&t._zoomIn()})).on("mousedown",(function(){event.preventDefault(),0==event.button&&(t.isDragging=!0)})).on("mouseup",(function(){event.preventDefault(),0==event.button&&(t.isDragging=!1)})).on("mouseout",(function(){t.isDragging=!1})).on("dblclick",(function(){t._resetZoom()}))}},{key:"_initHeader",value:function(){this.options.header.enable&&(this.headerCanvas=this.headerContainer.style("position","relative").style("height",this.options.header.height+2+"px").create("canvas").attr("height",this.options.header.height+2+"px").attr("width",this.width).style("position","absolute"),this.headerCtx=this.headerCanvas.elements[0].getContext("2d"),this.options.header.left=this.options.sequence.left+this.options.label.width+this.options.label.left+this.options.label.right)}},{key:"_updateSortInfo",value:function(t){var e=t.toArray();v(this.inputJson.sequences,(function(t){t.order=e.indexOf(t.name)})),this.drawSequences()}},{key:"drawSequences",value:function(){var t=this;it(this.ctx,this.width,this.canvasHeight);var e=this.options.seqHeight-this.options.sequence.topMargin-this.options.sequence.bottomMargin;V(this.ctx,e),Z(this.ctx,"center"),v(this.inputJson.sequences,(function(e){t._drawSequence(e)})),this._drawHighlightRect(),this._drawScaleBar(),this._drawHeader()}},{key:"_drawSequence",value:function(t){var e=this,i=this.options.seqHeight-this.options.sequence.topMargin-this.options.sequence.bottomMargin,n=this.options.scaleBar.height+this.options.seqHeight*(t.order+1)+this.options.sequence.topMargin-i/2,s=[];this.isConservedRegionMode?s=k(t.seq.split(""),this.conservedRegionBooleanArr).slice(parseInt(this.alignmentPosition.start+.5),parseInt(this.alignmentPosition.end+.5)):s=t.seq.substr(parseInt(this.alignmentPosition.start+.5),parseInt(this.alignmentPosition.end+.5)-parseInt(this.alignmentPosition.start+.5)).split("");if(0!=s.length){var o=s.length;this.baseWidth=this.options.sequence.width/o,Q(this.ctx,"black"),this.ctx.font=this.options.sequence.fontSize+"px Arial serif",this.baseWidth<10?v(s,(function(t,i){$(e.ctx,e.options.sequence.left+i*e.baseWidth,e.options.sequence.left+(i+1)*e.baseWidth,n,n,e.options.colorScheme[t])})):v(s,(function(t,i){$(e.ctx,e.options.sequence.left+i*e.baseWidth,e.options.sequence.left+(i+1)*e.baseWidth,n,n,e.options.colorScheme[t]),e.ctx.fillText(t,e.options.sequence.left+i*e.baseWidth+e.baseWidth/2,n+.33*e.options.sequence.fontSize)}))}}},{key:"_drawSequenceLabel",value:function(){var t=this;v(this.orderedAlignments,(function(e,i){t.options.seqHeight;t.labelDiv=t.labelContainer.create("div").attr("data-id",e.name).style("font-size",t.options.label.fontSize+"px").style("color",t.group[e.group].col).style("height",t.options.seqHeight+"px");var n=t.labelDiv.create("p").style("margin","0").style("height",t.options.seqHeight+"px");n.create("span").setClass("handle fas fa-expand-arrows-alt").html(" "),n.elements[0].innerHTML+=e.name+"_"+e.group}))}},{key:"_drawHighlightRect",value:function(){var t=this;v(this.highlightedIndicies,(function(e){var i=e.index,n=t.options.scaleBar.height+t.options.seqHeight*i+t.options.sequence.topMargin;!function(t,e,i,n,s,o,h){t.beginPath(),t.strokeStyle=o,t.lineWidth=h,t.strokeRect(e,i,n,s)}(t.ctx,t.options.sequence.left,n,t.options.sequence.width,t.options.seqHeight,"red",3)}))}},{key:"_drawScaleBar",value:function(){if(this.options.scaleBar.enable){V(this.ctx,1.5);var t=this.alignmentPosition.start,e=this.alignmentPosition.end,i=e-t,n=this.options.sequence.width>500?10:5,s=parseInt(i/n);n=parseInt(i/s),i<30&&this.baseWidth>20&&(n=i,s=1);for(var o=this.options.sequence.left,h=this.options.scaleBar.height-this.options.scaleBar.fontSize/2,a=0;a<n;a++)o=this.options.sequence.left+a*s*this.baseWidth+this.baseWidth/2,et(this.ctx,parseInt(t+a*s+.5+1),o,h,this.options.scaleBar.fontSize+"px Arial serif"),$(this.ctx,o,o,this.options.scaleBar.height,h+1,"grey");1!==s&&(o=this.options.sequence.left+parseInt(i+.5)*this.baseWidth-this.baseWidth/2,et(this.ctx,parseInt(e),o,h,this.options.scaleBar.fontSize+"px Arial serif"),$(this.ctx,o,o,this.options.scaleBar.height,h+1,"grey"))}}},{key:"_drawHeader",value:function(){if(this.options.header.enable){it(this.headerCtx,this.width,this.options.header.height),this._drawNonGrapRate(),this._drawSeqLogo(),V(this.headerCtx,1),i=this.headerCtx,n="black",i.strokeStyle=n;var t=this.options.header.left,e=this.options.header.top;$(this.headerCtx,t-10,t-10,this.options.header.height+1,e),$(this.headerCtx,this.width-1,this.width-1,this.options.header.height+1,e),$(this.headerCtx,t-10,this.width,e,e),$(this.headerCtx,t-10,this.width,this.options.header.height+1,this.options.header.height+1)}var i,n}},{key:"_drawSeqLogo",value:function(){var t=this;if(this.options.seqLogo.enable&&this.baseWidth>10){Z(this.headerCtx,"center"),Q(this.headerCtx,"black"),this.headerCtx.rotate(3*Math.PI/2),et(this.headerCtx,"bits",-this.options.header.height/2,this.options.header.left-35,"14px sans-serif"),this.headerCtx.rotate(1*Math.PI/2),Z(this.headerCtx,"right"),et(this.headerCtx,"0",this.options.header.left-14,this.options.header.height,"12px sans-serif"),et(this.headerCtx,"4.5",this.options.header.left-14,this.options.header.top+6,"12px sans-serif"),V(this.headerCtx,1),Z(this.headerCtx,"center"),this.headerCtx.font="900 "+30*(this.options.header.height-this.options.header.top)/100+'px "Arial Black", Arial, Gadget, sans-serif';var e=Math.log2(22),i=this.options.header.height-this.options.header.top-1,n=i/e,s=this.options.header.left,o=this.options.header.top+1,h=this.baseWidth,a=[];a=this.isConservedRegionMode?k(this.shannonEntropyArr,this.conservedRegionBooleanArr):this.shannonEntropyArr,v(a,(function(a,r){if(r>=parseInt(t.alignmentPosition.start+.5)&&r<=parseInt(t.alignmentPosition.end+.5-1)){var l=_(a),c=i*(1-l.sum/e);v(l.res,(function(a){var l=a.name.replace("-","\\"),u=i*a.value/e,d=u/n;t.headerCtx.transform(1,0,0,d,s+h/2+h*(r-parseInt(t.alignmentPosition.start+.5)),o+u+c),t.headerCtx.fillStyle=H[l],t.headerCtx.fillText(l,0,0,h),t.headerCtx.setTransform(1,0,0,1,0,0),c=u+c}))}}))}}},{key:"_drawNonGrapRate",value:function(){var t=this;if(this.options.nonGapRate.enable&&this.baseWidth<=10&&!this.isConservedRegionMode){Z(this.headerCtx,"center"),Q(this.headerCtx,"black"),this.headerCtx.rotate(3*Math.PI/2),et(this.headerCtx,"1 - gap rate",-this.options.header.height/2,this.options.header.left-35,"14px sans-serif"),this.headerCtx.rotate(1*Math.PI/2),Z(this.headerCtx,"right"),et(this.headerCtx,"0",this.options.header.left-14,this.options.header.height,"12px sans-serif"),et(this.headerCtx,"1",this.options.header.left-14,this.options.header.top+6,"12px sans-serif"),Z(this.headerCtx,"center"),V(this.headerCtx,this.baseWidth);var e=this.options.header.height,i=this.options.header.height-this.options.header.top-1;v(this.gapRate,(function(n,s){if(s>=parseInt(t.alignmentPosition.start+.5)&&s<=parseInt(t.alignmentPosition.end+.5-1)){var o=t.options.header.left+(s-parseInt(t.alignmentPosition.start+.5))*t.baseWidth+.5*t.baseWidth;$(t.headerCtx,o,o,e,e-i*(1-n),1-n>=t.options.nonGapRate.th?t.options.nonGapRate.highColor:t.options.nonGapRate.baseColor)}}))}}},{key:"_zoomIn",value:function(){var t=this.baseWidth<5?20:this.baseWidth<10?10:5;this.alignmentPosition.end-this.alignmentPosition.start>30?(this.alignmentPosition.start+=t,this.alignmentPosition.end-=t,this.drawSequences()):this.alignmentPosition.end-this.alignmentPosition.start>10?(this.alignmentPosition.start+=2,this.alignmentPosition.end-=2,this.drawSequences()):this.alignmentPosition.end-this.alignmentPosition.start>2&&(this.alignmentPosition.start+=1,this.alignmentPosition.end-=1,this.drawSequences())}},{key:"_zoomOut",value:function(){if(this.alignmentPosition.end-this.alignmentPosition.start<30)this.alignmentPosition.start-=2,this.alignmentPosition.end+=2;else{var t=this.baseWidth<5?20:this.baseWidth<10?10:5;if(0==this.alignmentPosition.start&&this.alignmentPosition.end==this.alignmentPosition.size)return;this.alignmentPosition.start-=t,this.alignmentPosition.end+=t,this.alignmentPosition.start<0&&(this.alignmentPosition.start=0),this.alignmentPosition.end>this.alignmentPosition.size&&(this.alignmentPosition.end=this.alignmentPosition.size)}this.drawSequences()}},{key:"_move",value:function(t){if(0!==t){var e=t/this.baseWidth;this.alignmentPosition.start-=e,this.alignmentPosition.end-=e,this.alignmentPosition.end>this.alignmentPosition.size&&(this.alignmentPosition.start+=e,this.alignmentPosition.end=this.alignmentPosition.size),this.alignmentPosition.start<0&&(this.alignmentPosition.start=0,this.alignmentPosition.end+=e),parseInt(this.alignmentPosition.start+.5)===parseInt(this.alignmentPosition.preStart+.5)&&parseInt(this.alignmentPosition.end-this.alignmentPosition.start+.5)===parseInt(this.alignmentPosition.preEnd-this.alignmentPosition.preStart+.5)||(this.alignmentPosition.preStart=this.alignmentPosition.start,this.alignmentPosition.preEnd=this.alignmentPosition.end,this.drawSequences())}}},{key:"_resetZoom",value:function(){this.alignmentPosition.preStart=this.alignmentPosition.start,this.alignmentPosition.preEnd=this.alignmentPosition.end,this.alignmentPosition.start=0,this.alignmentPosition.end=this.alignmentPosition.size,this.drawSequences()}}]),t}(),ot={elementId:"def",setSize:!1,height:600,width:600,outerRadius:400,innnerRadius:20,ringMargin:0,highlighterEnable:!0},ht=function(){function t(e){i(this,t),this.options=a({},ot,{},e),this.container=null,this.width=0,this.height=0,this.halfX=0,this.halfY=0,this.inputJson=null,this.numGenomes=null,this.maxRadius=0,this.ringSize=0,this.highlightCanvas=null,this.highlighter=null}return s(t,[{key:"setContainer",value:function(t){console.log("load element: "+t),this.container=z(t),this.container.html(""),this.options.elementId=t,this.options.setSize?(this.height=this.options.height,this.width=this.options.width):(this.width=this.container.elements[0].clientWidth,this.height=this.container.elements[0].clientHeight,this.options.outerRadius=this.width/2-50),this.canvasHeight=this.width,this.halfX=this.width/2,this.halfY=this.canvasHeight/2}},{key:"setJson",value:function(t){this.inputJson=t,this.numGenomes=t.genomes.length}},{key:"render",value:function(){this._DOMcreate(),this.ctx=this.mainCanvas.elements[0].getContext("2d"),this.options.highlighterEnable&&(this.highlighter=new at(this.highlightCanvas,this.width,this.canvasHeight,this.inputJson)),this.drawCircularGenomes()}},{key:"_DOMcreate",value:function(){this.bodyContainer=this.container.create("div").setID("".concat(this.options.elementId,"_body")).style("position","relative").setClass("d-flex flex-row"),this.canvasContainer=this.bodyContainer.create("div").setID("".concat(this.options.elementId,"_canvasContainer")).style("height","".concat(this.canvasHeight,"px")),this.mainCanvas=this.canvasContainer.create("canvas").style("position","absolute").style("top","0").setID("".concat(this.options.elementId,"_canvas")).attr("height",this.canvasHeight).attr("width",this.width).style("left","0"),this.highlightCanvas=this.canvasContainer.create("canvas").setID("".concat(this.options.elementId,"_highlight_canvas")).attr("height",this.canvasHeight).attr("width",this.width).style("position","absolute").style("top","0").style("left","0")}},{key:"redrawCircularGenomes",value:function(){this._drawKaryotype(),it(this.ctx,this.width,this.canvasHeight),this._drawCircularGenomes()}},{key:"drawCircularGenomes",value:function(){this._init_radius(),it(this.ctx,this.width,this.canvasHeight),this._drawKaryotype(),this._drawCircularGenomes()}},{key:"_init_radius",value:function(){this.ringSize=(this.options.outerRadius-(this.numGenomes-1)*this.options.ringMargin-this.options.innnerRadius)/this.numGenomes,this.ringSize<0&&(this.options.ringMargin=1,this.ringSize=(this.options.outerRadius-(this.numGenomes-1)*this.options.ringMargin-this.options.innnerRadius)/this.numGenomes),this.ringSize<0&&(this.options.ringMargin=0,this.ringSize=(this.options.outerRadius-this.options.innnerRadius)/this.numGenomes),console.log("Ring size: "+this.ringSize),console.log("this.options.ringMargin:",this.options.ringMargin),this.maxRadius=this.options.outerRadius+this.ringSize/2,this.highlighter&&(this.highlighter.maxRadius=this.maxRadius+10);for(var t=0;t<this.numGenomes;t++)this.inputJson.genomes[t].r=this.options.outerRadius-this.inputJson.genomes[t].order*(this.ringSize+this.options.ringMargin)}},{key:"_drawCircularGenomes",value:function(){V(this.ctx,this.ringSize);for(var t=0;t<this.numGenomes;t++)for(var e=0;e<this.inputJson.genomes[t].genes.length;e++)Math.abs(this.inputJson.genomes[t].genes[e].start_rotated_rad-this.inputJson.genomes[t].genes[e].end_rotated_rad)<1&&tt(this.ctx,this.halfX,this.halfY,this.inputJson.genomes[t].r,this.inputJson.genomes[t].genes[e].start_rotated_rad,this.inputJson.genomes[t].genes[e].end_rotated_rad,this.inputJson.genomes[t].genes[e].angle)}},{key:"_drawKaryotype",value:function(){V(this.ctx,5);for(var t=0;t<360;t++)tt(this.ctx,this.halfX,this.halfY,this.maxRadius,this.convertDeg2Rad(t),this.convertDeg2Rad(t+1),t)}},{key:"convertDeg2Rad",value:function(t){return 2*Math.PI*t/360}}]),t}(),at=function(){function t(e,n,s,o){i(this,t),this.canvas=e,this.width=n,this.height=s,this.halfX=this.width/2,this.halfY=this.height/2,this.maxRadius=0,this.ctx=this.canvas.elements[0].getContext("2d"),this.inputJson=o,this.isHighlightLock=!1,this.zoomSize=.1,this.updateFunction=null,this.zoomStart=0,this.zoomEnd=0,this._init()}return s(t,[{key:"clear",value:function(){it(this.ctx,this.width,this.height)}},{key:"showArc",value:function(t,e){this.clear(),this.setLineWidth(5),this.ctx.beginPath(),this.ctx.moveTo(this.halfX,this.halfY),this.ctx.arc(this.halfX,this.halfY,this.maxRadius,t,e),this.ctx.fillStyle="rgba(50,50,50,0.5)",this.ctx.strokeStyle="rgba(50,50,50, 0.7)",this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()}},{key:"showArcRegions",value:function(t,e,i,n){this.ctx.beginPath(),this.ctx.arc(this.halfX,this.halfY,t+e/2,i,n),this.ctx.lineTo(this.halfX+(t-e/2)*Math.cos(n),this.halfY+(t-e/2)*Math.sin(n)),this.ctx.arc(this.halfX,this.halfY,t-e/2,n,i,!0),this.ctx.lineTo(this.halfX+(t+e/2)*Math.cos(i),this.halfY+(t+e/2)*Math.sin(i)),this.ctx.stroke(),this.ctx.fill()}},{key:"setLineWidth",value:function(t){V(this.ctx,t)}},{key:"setUpdateFunction",value:function(t){this.updateFunction=t}},{key:"_init",value:function(){var t=this;this.canvas.on("mousemove",(function(){if(!t.isHighlightLock){var e=t.canvas.mouse,i=t._getAngleFromMousePosition(e);t.zoomStart=i-t.zoomSize,t.zoomEnd=i+t.zoomSize,t.showArc(t.zoomStart,t.zoomEnd)}})).on("mouseleave",(function(){t.isHighlightLock||t.clear()})).on("dblclick",(function(){event.preventDefault()})).on("click",(function(){event.preventDefault(),t.isHighlightLock?t.isHighlightLock=!1:(t.isHighlightLock=!0,t.updateFunction&&t.updateFunction(t.zoomStart,t.zoomEnd))}))}},{key:"_getAngleFromMousePosition",value:function(t){var e=t[0]-this.halfX,i=(t[1]-this.halfX)/e,n=Math.atan(i);return e<0?n+Math.PI:n}}]),t}(),rt={elementId:"def",setSize:!1,height:600,width:600,seqHeight:32,margin:4,label:{top:10,left:20,width:200},sequence:{top:10,left:20,right:20,marginY:2,cdsHeight:10,genomeHeight:10},tooltip:{height:75}},lt=function(){function t(e){i(this,t),this.options=a({},rt,{},e),this.start=12e4,this.end=13e4,this.seqWidthRatio=1}return s(t,[{key:"setRange",value:function(t,e){console.log("working set range"),this.start=(t+Math.PI/2)/(2*Math.PI)*this.inputJson.consensus_genome_size,this.end=(e+Math.PI/2)/(2*Math.PI)*this.inputJson.consensus_genome_size,this.redrawCDSs()}},{key:"setContainer",value:function(t){console.log("load element: "+t),this.container=z(t),this.container.html(""),this.options.elementId=t,this.options.setSize?(this.height=this.options.height,this.width=this.options.width,this.svgWidth=this.width-this.options.label.width-this.options.label.left-this.options.sequence.left-this.options.sequence.right):(this.width=this.container.elements[0].clientWidth,this.height=this.container.elements[0].clientHeight,this.svgWidth=this.width-this.options.label.width-this.options.label.left-this.options.sequence.left-this.options.sequence.right,console.log(this.width+" "+this.svgWidth))}},{key:"setJson",value:function(t){this.inputJson=t,this.numGenomes=t.genomes.length,this.svgHeight=(this.options.seqHeight+this.options.margin)*this.numGenomes}},{key:"render",value:function(){this._DOMcreate(),this.drawLinearGenomes()}},{key:"drawLinearGenomes",value:function(){this._clear(),this._drawLabels(),this._drawCDSBlocks()}},{key:"redrawCDSs",value:function(){this._clear(),this._drawCDSBlocks()}},{key:"_DOMcreate",value:function(){this.headerContainer=this.container.create("div").setID("".concat(this.options.elementId,"_header")),this.bodyContainer=this.container.create("div").setID("".concat(this.options.elementId,"_body")).style("position","relative").setClass("d-flex flex-row"),this.canvasContainer=this.bodyContainer.create("div").setID("".concat(this.options.elementId,"_canvasContainer")).style("position","relative").style("height","".concat(this.svgHeight,"px")),this.labelContainer=this.bodyContainer.create("div").setID("".concat(this.options.elementId,"_label")).style("margin-left","".concat(this.options.label.left,"px")).style("margin-top","".concat(this.options.label.top,"px")),this.mainSvg=this.canvasContainer.create("svg").setID("".concat(this.options.elementId,"_svg")).style("position","absolute").style("left",this.options.label.width+this.options.label.left+"px").style("top",this.options.sequence.top+"px").attr("height",this.svgHeight).attr("width",this.svgWidth),this.mainSvgGroup=this.mainSvg.create("g").setID("".concat(this.options.elementId,"_svg_group")),this.tooltip=this.bodyContainer.create("div").attr("class","linear-genome-tooltip")}},{key:"_initSvg",value:function(){}},{key:"_clear",value:function(){this.mainSvgGroup.remove(),this.mainSvgGroup=this.mainSvg.create("g").setID("".concat(this.options.elementId,"_svg_group"))}},{key:"_drawLabels",value:function(){var t=this;v(this.inputJson.genomes,(function(e,i){t.labelDiv=t.labelContainer.create("div").attr("data-id",e.name).style("font-size",t.options.label.fontSize+"px").style("height",t.options.seqHeight+"px");var n=t.labelDiv.create("div").style("margin",t.options.margin+"px 0 0 0").style("height",t.options.seqHeight+"px").setClass("d-flex align-items-center");n.create("span").setClass("handle fas fa-expand-arrows-alt"),n.elements[0].innerHTML+="&nbsp;"+e.name}))}},{key:"_drawCDSBlocks",value:function(){var t=this;this.seqWidthRatio=(this.end-this.start)/this.svgWidth,console.log("this.seqWidthRatio:",this.seqWidthRatio),v(this.inputJson.genomes,(function(e,i){var n=t.start*e.genome_size/t.inputJson.consensus_genome_size,s=n+(t.end-t.start);n<0&&console.log('genome["genome_size"]:',e.genome_size);var o=(t.options.seqHeight+t.options.margin)*e.order+t.options.sequence.genomeHeight+t.options.sequence.marginY;v(e.genes,(function(e){t._drawCDSBlock(e,n,s,o,0)}))}))}},{key:"_drawCDSBlock",value:function(t,e,i,n,s){var o=t.start_rotated+s,h=t.end_rotated+s,a=0,r=0;if(o>h||h-o>1e5)console.log("large");else{if(o>e&&h<i)a=this._convertGpositionToPixel(o-e),r=this._convertGpositionToPixel(h-e);else if(o<e&&h>e)a=0,r=this._convertGpositionToPixel(h-e);else{if(!(o<i&&h>i))return;a=this._convertGpositionToPixel(o-e),r=this.width-this.options.sequence.right}var l=r-a;-1===t.strand&&(n+=this.options.sequence.cdsHeight),this._drawSvg(a,n,l,this.options.sequence.cdsHeight,t)}}},{key:"_convertGpositionToPixel",value:function(t){return t/this.seqWidthRatio}},{key:"_drawSvg",value:function(t,e,i,n,s){var o=this,h=O[s.angle];this.mainSvgGroup.create("rect").attr("x",t).attr("y",e).attr("width",i).attr("height",n).attr("fill",h).on("mouseover",(function(){console.log("over"),o.tooltip.style("visibility","visible").style("top",e-o.options.tooltip.height+"px").style("left",o.options.label.width+o.options.label.left+t+"px").innerHTML("<p>name : "+s.locusTag+"</p><p>id : "+s.consensusId+"</p>")})).on("mousemove",(function(){o.tooltip.style("top",e-o.options.tooltip.height+"px").style("left",o.options.label.width+o.options.label.left+t+"px")})).on("mouseout",(function(){o.tooltip.style("visibility","hidden")})).on("mousedown",(function(){var t,e;console.log("click"),(t="http://127.0.0.1:8000/hp72/api/genbank/position/locusTag/"+s.locusTag,fetch(t,e).then((function(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}))).then((function(t){console.log(t)}))}))}},{key:"_test_db_access",value:function(){var t={seqs:[]};v(this.inputJson.genomes,(function(e,i){t.seqs.push({genome_ID:e.id,start:100,end:100})})),v(this.inputJson.genomes,(function(e,i){t.seqs.push({genome_ID:e.id,start:100,end:100})})),v(this.inputJson.genomes,(function(e,i){t.seqs.push({genome_ID:e.id,start:100,end:100})})),v(this.inputJson.genomes,(function(e,i){t.seqs.push({genome_ID:e.id,start:100,end:100})})),v(this.inputJson.genomes,(function(e,i){t.seqs.push({genome_ID:e.id,start:100,end:100})}));var e,i,n=performance.now();(e="http://127.0.0.1:8000/hp72/api/genome/test",i=function(t){return{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json; charset=utf-8"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(t)}}(t),fetch(e,i).then((function(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}))).then((function(t){console.log(t),console.log("performance: "+(performance.now()-n))}))}}]),t}();return t.Alignment=st,t.CLUSTAL2_COLOR={A:"#80a0f0",R:"#f01505",N:"#00ff00",D:"#c048c0",C:"#f08080",Q:"#00ff00",E:"#c048c0",G:"#f09048",H:"#15a4a4",I:"#80a0f0",L:"#80a0f0",K:"#f01505",M:"#80a0f0",F:"#80a0f0",P:"#ffff00",S:"#00ff00",T:"#00ff00",W:"#80a0f0",Y:"#15a4a4",V:"#80a0f0",B:"#fff",X:"#fff",Z:"#fff","-":"rgb(200,200,200)","\\":"rgb(200,200,200)"},t.COLER_ARR=O,t.CircularGenomeBrowser=ht,t.LinearGenomeBrowser=lt,t.Modal=Y,t.PROTEIN_COL_V1=E,t.STRAND_COLOR={A:"#5858a7",R:"#6b6b94",N:"#64649b",D:"#2121de",C:"#9d9d62",Q:"#8c8c73",E:"#0000ff",G:"#4949b6",H:"#60609f",I:"#ecec13",L:"#b2b24d",K:"#4747b8",M:"#82827d",F:"#c2c23d",P:"#2323dc",S:"#4949b6",T:"#9d9d62",W:"#c0c03f",Y:"#d3d32c",V:"#ffff00",B:"#4343bc",X:"#797986",Z:"#4747b8","-":"rgb(200,200,200)","\\":"rgb(200,200,200)"},t.TAYLOR_COLOR=H,t.calcGapRate=P,t.calcShannonEntropy=q,t.conservedRegionLength=S,t.countBy=b,t.each=v,t.exportJson=X,t.exportSVG=function(t,e){var i,n=t;window.ActiveXObject?i=n.xml:i=(new XMLSerializer).serializeToString(n);B(e+".svg","data:image/svg+xml;utf8,"+i).click()},t.exportText=j,t.filterAndSortEntroy=_,t.generateLink=B,t.getAllSequenceAsFasta=R,t.getColors=T,t.getConservedRegionAsFasta=I,t.getTrueArr=k,t.groupBy=y,t.indexBy=w,t.isConservedRegoin=C,t.json=function(t,e){return fetch(t,e).then((function(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.json()}))},t.select=D,t.selectAll=function(t){return new M(document.querySelectorAll(t))},t.selectClass=function(t){return new M([document.getElementsByClassName(t)])},t.selectID=z,t.seqStat=x,t.text=function(t,e){return fetch(t,e).then((function(t){if(!t.ok)throw new Error(t.status+" "+t.statusText);return t.text()}))},t}({});
//# sourceMappingURL=bundle.min.js.map
